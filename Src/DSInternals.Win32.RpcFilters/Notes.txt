// See https://aka.ms/new-console-template for more information
using DSInternals.Win32.RpcFilters;
using System.Net;

using (var fw = new RpcFilterManager())
{
    var filter = new RpcFilter()
    {
        Name = "TestFilter",
        Description = "Test filter description",
        FilterKey = Guid.Parse("98a1836e-06b0-4bf9-bb1b-0dd2e994a865"),
        InterfaceUUID = Guid.Parse("338CD001-2244-31F1-AAAA-900038001003"),
        DcomAppId = Guid.Parse("10000000-0000-0000-0000-000000000002"),
        Protocol = RpcProtocolSequence.ncacn_ip_tcp,
        NamedPipe = "winreg",
        SDDL = "D:(A;;CC;;;BA)",
        Action = RpcFilterAction.Block,
        Audit = true,
        IsPersistent = true,
        AuthenticationLevel = RpcAuthenticationLevel.PacketPrivacy,
        AuthenticationType = RpcAuthenticationType.Kerberos,
        IsBootTimeEnforced = false,
        Weight = 3,
        ImageName = "svchost.exe",
        LocalPort = 56345,
        RemoteAddress = IPAddress.Parse("fe80::bf1c:8c8e:f09d:c074"), //("192.168.0.1"),
        InterfaceVersion = 1,
        InterfaceFlag = 2
    };
    ulong id = fw.AddFilter(filter);
    var filters = fw.GetFilters().ToList();
}
